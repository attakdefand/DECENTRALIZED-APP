# Group A - Smart Contracts Testing Plan

## Overview
Group A focuses on the foundational layer of testing for the decentralized application, ensuring the core smart contract logic and mathematical safety.

## Testing Domains

### 1. Logic & Math Testing
**Functions/Scenarios**:
- Conservation
- Monotonicity
- Reentrancy protection
- Bounds checking
- Fee routing

**Tools**:
- Foundry (forge test/fuzz/invariant)
- Echidna
- Slither

**CI Gate Requirements**:
- All unit, fuzz, and invariant tests must pass
- Slither static analysis must show no critical vulnerabilities
- Gas consumption must stay within defined thresholds

### 2. Upgradeability Testing
**Functions/Scenarios**:
- Storage layout compatibility
- Proxy/UUPS diff
- No storage slot collisions across upgrades
- Timelock/guardian flow

**Tools**:
- OpenZeppelin Upgrades
- Storage-layout diff
- Shadow-fork dry-run

**CI Gate Requirements**:
- Upgrade PRs require layout diff green + dry-run evidence

### 3. AMM/DEX Testing
**Functions/Scenarios**:
- Curve correctness
- CPMM/Stable/CLAMM invariants
- x*y=k, amplification behavior, per-tick liquidity/fees

**Tools**:
- Model-based tests (Python/Rust)
- Foundry invariants

**CI Gate Requirements**:
- AMM invariant suite green
- Reconciliation within epsilon

### 4. Orderbook Testing
**Functions/Scenarios**:
- Price-time priority & partial fills
- Place/cancel/match
- IOC/FOK
- Fairness

**Tools**:
- Engine unit tests
- Replay fixtures
- MEV sims

**CI Gate Requirements**:
- LOB suite green
- Fairness metrics within target

### 5. Lending/Perps Testing
**Functions/Scenarios**:
- Risk & Liquidations
- HF, Kink IR, funding/insurance
- Liquidate below HF
- Correct funding
- Insurance waterfall

**Tools**:
- Economic sims/backtests
- Invariant checks

**CI Gate Requirements**:
- Risk sims green
- Bad-debt in stress â‰¤ budget

### 6. Oracle Testing
**Functions/Scenarios**:
- Manipulation/liveness
- Median/TWAP/outlier/staleness
- Reject stale/outlier
- Quorum met
- Fallback works

**Tools**:
- Replay feeds
- Boundary tests
- Kill-switch drills

**CI Gate Requirements**:
- Oracle tests green
- Staleness < threshold

### 7. MEV & Fairness Testing
**Functions/Scenarios**:
- Order protection
- Commit-reveal / FBA
- Reveal windows
- Uniform clearing
- Anti-sandwich bounds

**Tools**:
- Batch sims
- Solver cross-checks
- Timing tests

**CI Gate Requirements**:
- MEV sims green
- Bounds enforced

### 8. Account Abstraction Testing
**Functions/Scenarios**:
- UserOps validation
- Paymaster/session key scope
- Nonces, signatures, budgets, capability scoping

**Tools**:
- 4337 bundler harness
- Fuzz
- Scope-leak tests

**CI Gate Requirements**:
- AA suite green
- Budget adherence

### 9. Tx/Mempool Testing
**Functions/Scenarios**:
- Privacy & replay
- Private routes, deadlines, permit
- EIP-155 replay
- Domain separator
- Expiry enforced

**Tools**:
- Permit fuzz
- Private route checks

**CI Gate Requirements**:
- Replay tests green
- Expired rejected

### 10. Cross-chain / Bridges Testing
**Functions/Scenarios**:
- Proof verification
- Light/Optimistic/ZK
- Header/receipt proof valid
- Challenge windows
- Replay guard

**Tools**:
- Fixture proofs
- Fraud-proof sims
- ZK verifier tests

**CI Gate Requirements**:
- Bridge suite green
- Gas within cap